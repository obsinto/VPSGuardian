#!/bin/bash
################################################################################
# VPS Guardian - Configuração Global
# Este arquivo é carregado por todos os scripts do projeto
################################################################################

# Diretório raiz do projeto
VPSGUARDIAN_ROOT="${VPSGUARDIAN_ROOT:-/opt/vpsguardian}"

# Diretórios de backup
BACKUP_ROOT="${BACKUP_ROOT:-/var/backups/vpsguardian}"
COOLIFY_BACKUP_DIR="$BACKUP_ROOT/coolify"
DATABASE_BACKUP_DIR="$BACKUP_ROOT/databases"
VOLUME_BACKUP_DIR="$BACKUP_ROOT/volumes"

# Diretórios de log
LOG_DIR="${LOG_DIR:-/var/log/vpsguardian}"

# Políticas de retenção (em dias)
BACKUP_RETENTION_DAYS="${BACKUP_RETENTION_DAYS:-30}"
LOG_RETENTION_DAYS="${LOG_RETENTION_DAYS:-90}"

# Retenção de backups locais (após upload para S3)
LOCAL_BACKUP_RETENTION_DAYS="${LOCAL_BACKUP_RETENTION_DAYS:-7}"

# Retenção por quantidade (alternativa à retenção por dias)
# Se definido, mantém últimos X backups independente da idade
# 0 = desabilitado (usa retenção por dias)
BACKUP_RETENTION_COUNT="${BACKUP_RETENTION_COUNT:-0}"

# Estratégia de retenção: simple, count, gfs
# simple = deleta backups mais antigos que BACKUP_RETENTION_DAYS
# count = mantém últimos BACKUP_RETENTION_COUNT backups
# gfs = Grandfather-Father-Son (7 diários, 4 semanais, 12 mensais)
BACKUP_RETENTION_STRATEGY="${BACKUP_RETENTION_STRATEGY:-simple}"

# Configurações de notificação (opcional)
NOTIFICATION_EMAIL="${NOTIFICATION_EMAIL:-}"
WEBHOOK_URL="${WEBHOOK_URL:-}"

# Coolify
COOLIFY_DATA_DIR="/data/coolify"
COOLIFY_SOURCE_DIR="$COOLIFY_DATA_DIR/source"
COOLIFY_SSH_KEYS_DIR="$COOLIFY_DATA_DIR/ssh/keys"

# Docker
DOCKER_SOCKET="/var/run/docker.sock"

# Configurações de migração
MIGRATION_LOG_DIR="$VPSGUARDIAN_ROOT/migration-logs"
MIGRATION_BACKUP_DIR="/tmp/vpsguardian-migration"

# Lock files
LOCK_DIR="/var/lock"
BACKUP_LOCK_FILE="$LOCK_DIR/vpsguardian-backup.lock"
MIGRATION_LOCK_FILE="$LOCK_DIR/vpsguardian-migration.lock"

# Timeouts (em segundos)
SSH_TIMEOUT="${SSH_TIMEOUT:-30}"
BACKUP_TIMEOUT="${BACKUP_TIMEOUT:-3600}"

# Debug mode
DEBUG="${DEBUG:-0}"
